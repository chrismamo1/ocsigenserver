=Module <<a_api_type | module Ocsigen_extensions >> =
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|module>> <<span class="ocsforge_color_uid"|<<span class="ocsforge_color_uid"|Ocsigen_extensions>>>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="ocsforge_color_keyword"|sig>><<a_api text=".." | module Ocsigen_extensions >><<span class="ocsforge_color_keyword"|end>>>>~Writing extensions for ~Ocsigen

----
<<pre id="EXCEPTIONOcsigen_http_error" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Ocsigen_http_error>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >><<a_api text="Ocsigen_cookies.cookieset" | type Ocsigen_cookies.cookieset >> * int<<span class="ocsforge_color_delimiter"| ) >>>>>><<pre id="EXCEPTIONBad_config_tag_for_extension" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Bad_config_tag_for_extension>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|string>>>><<div class="odocwiki_info"|~Xml tag not recognized by an extension ~(usually not a real error~)
>>
<<pre id="EXCEPTIONError_in_config_file" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Error_in_config_file>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|string>>>><<div class="odocwiki_info"|~Error in a ~<site~> tag inside the main ocsigen~.conf file
>>
<<pre id="EXCEPTIONError_in_user_config_file" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Error_in_user_config_file>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|string>>>><<div class="odocwiki_info"|~Option incorrect in a userconf file
>>
<<pre id="VALbadconfig" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|badconfig>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >>'a, unit, string, 'b<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_uid"|Pervasives>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|format4>> <<span class="ocsforge_color_delimiter"| -> >> 'a>>>><<div class="odocwiki_info"|~Convenient function for raising ~Error~_in~_config~_file exceptions with
    a sprintf~-formatted argument~.
>>
<<pre class="ocsforge_color odocwiki_code" id="TYPEvirtual_hosts"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|virtual~_hosts>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >>string * <<span class="ocsforge_color_uid"|Netstring_pcre>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|regexp>> * int option<<span class="ocsforge_color_delimiter"| ) >> list>> >><<div class="odocwiki_info"|~Type of the result of parsing the field <<span class="odocwiki_inlinecode"|hostfiler>> in the configuration
    file~. ~Inside the list~, the first argument is the host itself
    ~(which is a glob~-like pattern that can contains <<span class="odocwiki_inlinecode"|~*>>~)~, a regexp
    parsing this pattern~, and optionnaly a port~.
>>
<<pre id="VALhash_virtual_hosts" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|hash~_virtual~_hosts>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="virtual_hosts" | type Ocsigen_extensions.virtual_hosts >> <<span class="ocsforge_color_delimiter"| -> >> int>>>><<pre id="VALequal_virtual_hosts" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|equal~_virtual~_hosts>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<a_api text="virtual_hosts" | type Ocsigen_extensions.virtual_hosts >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="virtual_hosts" | type Ocsigen_extensions.virtual_hosts >> <<span class="ocsforge_color_delimiter"| -> >> bool>>>><<pre id="VALhost_match" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|host~_match>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| virtual_hosts: >><<a_api text="virtual_hosts" | type Ocsigen_extensions.virtual_hosts >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| host: >>string option <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| port: >>int <<span class="ocsforge_color_delimiter"| -> >> bool>>>><<pre class="ocsforge_color odocwiki_code" id="TYPEdo_not_serve"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|do~_not~_serve>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="ocsforge_color_delimiter"|~{>>
<<span class="odocwiki_record"|<<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|do_not_serve_regexps:>> <<span class="odocwiki_type"|string list>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|do_not_serve_files:>> <<span class="odocwiki_type"|string list>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|do_not_serve_extensions:>> <<span class="odocwiki_type"|string list>><<span class="ocsforge_color_delimiter"|~;>> >>>>>><<span class="ocsforge_color_delimiter"|~}>>>><<div class="odocwiki_info"|~Configuration to hide~/forbid local files
>>
<<pre id="EXCEPTIONIncorrectRegexpes" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|IncorrectRegexpes>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<a_api text="do_not_serve" | type Ocsigen_extensions.do_not_serve >>>>>><<pre id="VALdo_not_serve_to_regexp" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|do~_not~_serve~_to~_regexp>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="do_not_serve" | type Ocsigen_extensions.do_not_serve >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_uid"|Netstring_pcre>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|regexp>>>>>><<div class="odocwiki_info"|~Compile a do~_not~_serve structure into a regexp~. ~Raises
    <<span class="odocwiki_inlinecode"|~Incorrect~Regexpes>> if the compilation fails~. ~The result is
    memoized for subsequent calls with the same argument
>>
<<pre id="VALjoin_do_not_serve" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|join~_do~_not~_serve>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<a_api text="do_not_serve" | type Ocsigen_extensions.do_not_serve >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="do_not_serve" | type Ocsigen_extensions.do_not_serve >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="do_not_serve" | type Ocsigen_extensions.do_not_serve >>>>>><<pre class="ocsforge_color odocwiki_code" id="TYPEconfig_info"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|config~_info>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="ocsforge_color_delimiter"|~{>>
<<span class="odocwiki_record"|<<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|default_hostname:>> <<span class="odocwiki_type"|string>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|default_httpport:>> <<span class="odocwiki_type"|int>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|default_httpsport:>> <<span class="odocwiki_type"|int>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|default_protocol_is_https:>> <<span class="odocwiki_type"|bool>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|mime_assoc:>> <<span class="odocwiki_type"|<<a_api text="Ocsigen_charset_mime.mime_assoc" | type Ocsigen_charset_mime.mime_assoc >>>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|charset_assoc:>> <<span class="odocwiki_type"|<<a_api text="Ocsigen_charset_mime.charset_assoc" | type Ocsigen_charset_mime.charset_assoc >>>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|default_directory_index:>> <<span class="odocwiki_type"|string list>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|list_directory_content:>> <<span class="odocwiki_type"|bool>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|follow_symlinks:>> <<span class="odocwiki_type"|<<a_api text="follow_symlink" | type Ocsigen_extensions.follow_symlink >>>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|do_not_serve_404:>> <<span class="odocwiki_type"|<<a_api text="do_not_serve" | type Ocsigen_extensions.do_not_serve >>>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|do_not_serve_403:>> <<span class="odocwiki_type"|<<a_api text="do_not_serve" | type Ocsigen_extensions.do_not_serve >>>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|uploaddir:>> <<span class="odocwiki_type"|string option>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|maxuploadfilesize:>> <<span class="odocwiki_type"|int64 option>><<span class="ocsforge_color_delimiter"|~;>> >>>>>><<span class="ocsforge_color_delimiter"|~}>>>><<div class="odocwiki_info"|~Configuration options~, passed to ~(and modified by~) extensions
>>
<<pre class="ocsforge_color odocwiki_code" id="TYPEfollow_symlink"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|follow~_symlink>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_variants"|<<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|DoNotFollowSymlinks>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Never follow a symlink>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|FollowSymlinksIfOwnerMatch>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Follow a symlink if the symlink and its
                          target have the same owner>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|AlwaysFollowSymlinks>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Always follow symlinks>><<span class="odocwiki_comments_close"| ~*)>>>>>>>>>><<pre class="ocsforge_color odocwiki_code" id="TYPEclient"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|client>>>><<div class="odocwiki_info"|~A value of this type represents the client who did the request~.
>>
<<pre id="VALclient_id" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|client~_id>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="client" | type Ocsigen_extensions.client >> <<span class="ocsforge_color_delimiter"| -> >> int>>>><<div class="odocwiki_info"|~Returns the id number of the connection
>>
<<pre id="VALclient_connection" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|client~_connection>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="client" | type Ocsigen_extensions.client >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="Ocsigen_http_com.connection" | type Ocsigen_http_com.connection >>>>>><<div class="odocwiki_info"|~Returns the connection
>>
<<pre class="ocsforge_color odocwiki_code" id="TYPEifrange"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|ifrange>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_variants"|<<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|IR_No>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|IR_Ifunmodsince>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|float>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|IR_ifmatch>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|string>>>>>>>>>><<pre class="ocsforge_color odocwiki_code" id="TYPEfile_info"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|file~_info>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="ocsforge_color_delimiter"|~{>>
<<span class="odocwiki_record"|<<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|tmp_filename:>> <<span class="odocwiki_type"|string>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|filesize:>> <<span class="odocwiki_type"|int64>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|raw_original_filename:>> <<span class="odocwiki_type"|string>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|original_basename:>> <<span class="odocwiki_type"|string>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|file_content_type:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >><<span class="ocsforge_color_delimiter"| ( >>string * string<<span class="ocsforge_color_delimiter"| ) >> * <<span class="ocsforge_color_delimiter"| ( >>string * string<<span class="ocsforge_color_delimiter"| ) >> list<<span class="ocsforge_color_delimiter"| ) >> option>><<span class="ocsforge_color_delimiter"|~;>> >>>>>><<span class="ocsforge_color_delimiter"|~}>>>><<pre class="ocsforge_color odocwiki_code" id="TYPErequest_info"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|request~_info>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="ocsforge_color_delimiter"|~{>>
<<span class="odocwiki_record"|<<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_url_string:>> <<span class="odocwiki_type"|string>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|full ~U~R~L>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_method:>> <<span class="odocwiki_type"|<<a_api text="Ocsigen_http_frame.Http_header.http_method" | type Ocsigen_http_frame.Http_header.http_method >>>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~G~E~T~, ~P~O~S~T~, ~H~E~A~D~.~.~.>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_protocol:>> <<span class="odocwiki_type"|<<a_api text="Ocsigen_http_frame.Http_header.proto" | type Ocsigen_http_frame.Http_header.proto >>>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~H~T~T~P protocol used by client>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_ssl:>> <<span class="odocwiki_type"|bool>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|true if ~H~T~T~P~S~, false if ~H~T~T~P>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_full_path_string:>> <<span class="odocwiki_type"|string>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|full path of the ~U~R~L>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_full_path:>> <<span class="odocwiki_type"|string list>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|full path of the ~U~R~L>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_original_full_path_string:>> <<span class="odocwiki_type"|string>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|full path of the ~U~R~L~, as first sent by the client~. ~Should not be changed by extensions~, even rewritemod~. ~It is used to create relative links~.>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_original_full_path:>> <<span class="odocwiki_type"|string list>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|full path of the ~U~R~L~, as first sent by the client~. ~See below~.>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_sub_path:>> <<span class="odocwiki_type"|string list>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|path of the ~U~R~L ~(only part concerning the site~)>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_sub_path_string:>> <<span class="odocwiki_type"|string>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|path of the ~U~R~L ~(only part concerning the site~)>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_get_params_string:>> <<span class="odocwiki_type"|string option>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|string containing ~G~E~T parameters>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_host:>> <<span class="odocwiki_type"|string option>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Host field of the request ~(if any~)~, without port>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_port_from_host_field:>> <<span class="odocwiki_type"|int option>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Port in the host field of the request ~(if any~)>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_get_params:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >>string * string<<span class="ocsforge_color_delimiter"| ) >> list <<span class="ocsforge_color_uid"|Lazy>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Association list of get parameters>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_initial_get_params:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >>string * string<<span class="ocsforge_color_delimiter"| ) >> list <<span class="ocsforge_color_uid"|Lazy>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Association list of get parameters~, as sent by the browser ~(must not be modified by extensions~)>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_post_params:>> <<span class="odocwiki_type"|\\    <<span class="ocsforge_color_delimiter"| ( >><<a_api text="config_info" | type Ocsigen_extensions.config_info >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_delimiter"| ( >>string * string<<span class="ocsforge_color_delimiter"| ) >> list <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >>\\    option>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Association list of post parameters~, if urlencoded form parameters or multipart data~. ~None if other content type or no content~.>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_files:>> <<span class="odocwiki_type"|\\    <<span class="ocsforge_color_delimiter"| ( >><<a_api text="config_info" | type Ocsigen_extensions.config_info >> <<span class="ocsforge_color_delimiter"| -> >>\\     <<span class="ocsforge_color_delimiter"| ( >>string * <<a_api text="file_info" | type Ocsigen_extensions.file_info >><<span class="ocsforge_color_delimiter"| ) >> list <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >>\\    option>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Files sent in the request ~(multipart data~)~. ~None if other content type or no content~.>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_remote_inet_addr:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_uid"|Unix>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|inet_addr>>>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~I~P of the client>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_remote_ip:>> <<span class="odocwiki_type"|string>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~I~P of the client>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_remote_ip_parsed:>> <<span class="odocwiki_type"|<<a_api text="Ocsigen_lib.Ip_address.t" | type Ocsigen_lib.Ip_address.t >> <<span class="ocsforge_color_uid"|Lazy>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~I~P of the client~, parsed>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_remote_port:>> <<span class="odocwiki_type"|int>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Port used by the client>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_forward_ip:>> <<span class="odocwiki_type"|string list>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~I~Ps of gateways the request went throught>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_server_port:>> <<span class="odocwiki_type"|int>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Port of the request ~(server~)>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_user_agent:>> <<span class="odocwiki_type"|string>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~User~_agent of the browser>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_cookies_string:>> <<span class="odocwiki_type"|string option <<span class="ocsforge_color_uid"|Lazy>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Cookies sent by the browser>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_cookies:>> <<span class="odocwiki_type"|string <<span class="ocsforge_color_uid"|Ocsigen_cookies>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|CookiesTable>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>> <<span class="ocsforge_color_uid"|Lazy>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Cookies sent by the browser>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_ifmodifiedsince:>> <<span class="odocwiki_type"|float option>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|if~-modified~-since field>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_ifunmodifiedsince:>> <<span class="odocwiki_type"|float option>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|if~-unmodified~-since field>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_ifnonematch:>> <<span class="odocwiki_type"|string list option>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|if~-none~-match field ~( ~* and weak entity tags not implemented~)>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_ifmatch:>> <<span class="odocwiki_type"|string list option>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|if~-match field ~( ~* not implemented~)>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_content_type:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >><<span class="ocsforge_color_delimiter"| ( >>string * string<<span class="ocsforge_color_delimiter"| ) >> * <<span class="ocsforge_color_delimiter"| ( >>string * string<<span class="ocsforge_color_delimiter"| ) >> list<<span class="ocsforge_color_delimiter"| ) >> option>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Content~-~Type ~H~T~T~P header>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_content_type_string:>> <<span class="odocwiki_type"|string option>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Content~-~Type ~H~T~T~P header>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_content_length:>> <<span class="odocwiki_type"|int64 option>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Content~-~Length ~H~T~T~P header>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_referer:>> <<span class="odocwiki_type"|string option <<span class="ocsforge_color_uid"|Lazy>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Referer ~H~T~T~P header>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_origin:>> <<span class="odocwiki_type"|string option <<span class="ocsforge_color_uid"|Lazy>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Where the cross~-origin request or preflight request originates from~.
         http~:~/~/www~.w~3~.org~/~T~R~/cors~/~#origin~-request~-header>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_access_control_request_method:>> <<span class="odocwiki_type"|string option <<span class="ocsforge_color_uid"|Lazy>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|which method will be used in the actual request as part of
         the preflight request~.
         http~:~/~/www~.w~3~.org~/~T~R~/cors~/~#access~-control~-request~-method~-request~-he>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_access_control_request_headers:>> <<span class="odocwiki_type"|string list option <<span class="ocsforge_color_uid"|Lazy>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Which headers will be used in the actual request as part of
         the preflight request~.
         http~:~/~/www~.w~3~.org~/~T~R~/cors~/~#access~-control~-request~-headers~-request~-h>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_accept:>> <<span class="odocwiki_type"|\\    <<span class="ocsforge_color_delimiter"| ( >><<span class="ocsforge_color_delimiter"| ( >>string option * string option<<span class="ocsforge_color_delimiter"| ) >> * float option *\\     <<span class="ocsforge_color_delimiter"| ( >>string * string<<span class="ocsforge_color_delimiter"| ) >> list<<span class="ocsforge_color_delimiter"| ) >>\\    list <<span class="ocsforge_color_uid"|Lazy>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Accept ~H~T~T~P header~. ~For example <<span class="odocwiki_inlinecode"|~(~Some "text"~, ~None~)>> means <<span class="odocwiki_inlinecode"|"text~/~*">>~. ~The float is the "quality" value~, if any~. ~The last association list is for other extensions~.>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_accept_charset:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >>string option * float option<<span class="ocsforge_color_delimiter"| ) >> list <<span class="ocsforge_color_uid"|Lazy>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Accept~-~Charset ~H~T~T~P header~. <<span class="odocwiki_inlinecode"|~None>> for the first value means "~*"~. ~The float is the "quality" value~, if any~.>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_accept_encoding:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >>string option * float option<<span class="ocsforge_color_delimiter"| ) >> list <<span class="ocsforge_color_uid"|Lazy>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Accept~-~Encoding ~H~T~T~P header~. <<span class="odocwiki_inlinecode"|~None>> for the first value means "~*"~. ~The float is the "quality" value~, if any~.>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_accept_language:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >>string * float option<<span class="ocsforge_color_delimiter"| ) >> list <<span class="ocsforge_color_uid"|Lazy>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Accept~-~Language ~H~T~T~P header~. ~The float is the "quality" value~, if any~.>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_http_frame:>> <<span class="odocwiki_type"|<<a_api text="Ocsigen_http_frame.t" | type Ocsigen_http_frame.t >>>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~The full http~_frame>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_keyword"|mutable >><<span class="ocsforge_color_label"|ri_request_cache:>> <<span class="odocwiki_type"|<<a_api text="Polytables.t" | type Polytables.t >>>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Use this to put anything you want~,
         for example~, information for subsequent
         extensions>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_client:>> <<span class="odocwiki_type"|<<a_api text="client" | type Ocsigen_extensions.client >>>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~The request connection>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_range:>> <<span class="odocwiki_type"|\\    <<span class="ocsforge_color_delimiter"| ( >><<span class="ocsforge_color_delimiter"| ( >>int64 * int64<<span class="ocsforge_color_delimiter"| ) >> list * int64 option * <<a_api text="ifrange" | type Ocsigen_extensions.ifrange >><<span class="ocsforge_color_delimiter"| ) >>\\    option <<span class="ocsforge_color_uid"|Lazy>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Range ~H~T~T~P header~. <<span class="odocwiki_inlinecode"|~None>> means all the document~.
         ~List of intervals ~+ possibly from an index to the end of the document~.>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_timeofday:>> <<span class="odocwiki_type"|float>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~An ~Unix timestamp computed at the beginning of the request>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_keyword"|mutable >><<span class="ocsforge_color_label"|ri_nb_tries:>> <<span class="odocwiki_type"|int>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~For internal use~:
                                   used to prevent loops of requests>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|ri_connection_closed:>> <<span class="odocwiki_type"|unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>><<span class="ocsforge_color_delimiter"|~;>> >><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|a thread waking up when the connection is closed>><<span class="odocwiki_comments_close"| ~*)>>>>>>>><<span class="ocsforge_color_delimiter"|~}>>>><<div class="odocwiki_info"|~The request

~If you force <<span class="odocwiki_inlinecode"|ri~_files>> or <<span class="odocwiki_inlinecode"|ri~_post~_params>>~, the request is fully read~,
   so it is not possible any more to read it from <<span class="odocwiki_inlinecode"|ri~_http~_frame>>
   ~(and vice versa~)~.
>>
<<pre class="ocsforge_color odocwiki_code" id="TYPErequest"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|request>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="ocsforge_color_delimiter"|~{>>
<<span class="odocwiki_record"|<<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|request_info:>> <<span class="odocwiki_type"|<<a_api text="request_info" | type Ocsigen_extensions.request_info >>>><<span class="ocsforge_color_delimiter"|~;>> >>>><<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|request_config:>> <<span class="odocwiki_type"|<<a_api text="config_info" | type Ocsigen_extensions.config_info >>>><<span class="ocsforge_color_delimiter"|~;>> >>>>>><<span class="ocsforge_color_delimiter"|~}>>>><<pre id="EXCEPTIONOcsigen_Is_a_directory" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Ocsigen_Is_a_directory>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<a_api text="request" | type Ocsigen_extensions.request >>>>>><<pre class="ocsforge_color odocwiki_code" id="TYPEanswer"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|answer>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_variants"|<<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_do_nothing>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~I don~'t want to do anything>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_found>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >>unit <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="Ocsigen_http_frame.result" | type Ocsigen_http_frame.result >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >>>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|"~O~K stop! ~I will take the page~.
          ~You can start the following request of the same pipelined connection~.
          ~Here is the function to generate the page"~.
          ~The extension must return ~Ext~_found as soon as possible
          when it is sure it is safe to start next request~.
          ~Usually as soon as you know that the result will be ~Ext~_found~.
          ~But in some case~, for example proxies~, you don~'t want the request of
          one connection to be handled in different order~.
          ~In that case~, wait to be sure that the new request will not
          overtake this one~.>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_found_stop>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >>unit <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="Ocsigen_http_frame.result" | type Ocsigen_http_frame.result >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >>>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Found but do not try next extensions>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_next>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|int>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Page not found~. ~Try next extension~.
                        ~The integer is the ~H~T~T~P error code~.
                        ~It is usally ~4~0~4~, but may be for ex ~4~0~3 ~(forbidden~)
                        if you want another extension to try after a ~4~0~3~.
                        ~Same as ~Ext~_continue~_with but does not change
                        the request~.>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_stop_site>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >><<a_api text="Ocsigen_cookies.cookieset" | type Ocsigen_cookies.cookieset >> * int<<span class="ocsforge_color_delimiter"| ) >>>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Error~. ~Do not try next extension~, but
                        try next site~.
                        ~The integer is the ~H~T~T~P error code~, usally ~4~0~3~.>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_stop_host>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >><<a_api text="Ocsigen_cookies.cookieset" | type Ocsigen_cookies.cookieset >> * int<<span class="ocsforge_color_delimiter"| ) >>>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Error~. ~Do not try next extension~,
                        do not try next site~,
                        but try next host~.
                        ~The integer is the ~H~T~T~P error code~, usally ~4~0~3~.>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_stop_all>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >><<a_api text="Ocsigen_cookies.cookieset" | type Ocsigen_cookies.cookieset >> * int<<span class="ocsforge_color_delimiter"| ) >>>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Error~. ~Do not try next extension ~(even filters~)~,
                        do not try next site~,
                        do not try next host~,
                        do not ~.
                        ~The integer is the ~H~T~T~P error code~, usally ~4~0~3~.>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_continue_with>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >><<a_api text="request" | type Ocsigen_extensions.request >> * <<a_api text="Ocsigen_cookies.cookieset" | type Ocsigen_cookies.cookieset >> * int<<span class="ocsforge_color_delimiter"| ) >>>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Used to modify the request before giving it to next extension~.
            ~The extension returns the request~_info ~(possibly modified~)
            and a set of cookies if it wants to set or cookies
            ~(<<span class="odocwiki_inlinecode"|!~Ocsigen~_cookies~.~Cookies~.empty>> for no cookies~)~.
            ~You must add these cookies yourself in request~_info if you
            want them to be seen by subsequent extensions~,
            for example using <<a_api | val Ocsigen_http_frame.compute_new_ri_cookies >>~.
            ~The integer is usually equal to the error code received
            from preceding extension ~(but you may want to modify it~)~.>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_retry_with>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<a_api text="request" | type Ocsigen_extensions.request >> * <<a_api text="Ocsigen_cookies.cookieset" | type Ocsigen_cookies.cookieset >>>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Used to retry all the extensions with a new request~_info~.
            ~The extension returns the request~_info ~(possibly modified~)
            and a set of cookies if it wants to set or cookies
            ~(<<span class="odocwiki_inlinecode"|!~Ocsigen~_cookies~.~Cookies~.empty>> for no cookies~)~.
            ~You must add these cookies yourself in request~_info if you
            want them to be seen by subsequent extensions~,
            for example using <<a_api | val Ocsigen_http_frame.compute_new_ri_cookies >>~.>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_sub_result>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<a_api text="extension2" | type Ocsigen_extensions.extension2 >>>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Used if your extension want to define option that may contain
            other options from other extensions~.
            ~In that case~, while parsing the configuration file~, call
            the parsing function ~(of type <<span class="odocwiki_inlinecode"|parse~_fun>>~)~,
            that will return something of type <<span class="odocwiki_inlinecode"|extension~2>>~.>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_found_continue_with>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|\\    <<span class="ocsforge_color_delimiter"| ( >>unit <<span class="ocsforge_color_delimiter"| -> >>\\     <<span class="ocsforge_color_delimiter"| ( >><<a_api text="Ocsigen_http_frame.result" | type Ocsigen_http_frame.result >> * <<a_api text="request" | type Ocsigen_extensions.request >><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >>>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Same as <<span class="odocwiki_inlinecode"|~Ext~_found>> but may modify the request~.>><<span class="odocwiki_comments_close"| ~*)>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Ext_found_continue_with'>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >><<a_api text="Ocsigen_http_frame.result" | type Ocsigen_http_frame.result >> * <<a_api text="request" | type Ocsigen_extensions.request >><<span class="ocsforge_color_delimiter"| ) >>>>>><<span class="odocwiki_comments"|<<span class="odocwiki_comments_open"|(*>> <<span|~Same as <<span class="odocwiki_inlinecode"|~Ext~_found~_continue~_with>> but does not allow to delay
            the computation of the page~. ~You should probably not use it~,
            but for output filters~.>><<span class="odocwiki_comments_close"| ~*)>>>>>>>>>><<pre class="ocsforge_color odocwiki_code" id="TYPErequest_state"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|request~_state>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_variants"|<<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Req_not_found>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >>int * <<a_api text="request" | type Ocsigen_extensions.request >><<span class="ocsforge_color_delimiter"| ) >>>>>>>><<span class="odocwiki_variant"|<<span class="odocwiki_variant_constr"|<<span class="ocsforge_color_keyword"| ~|>> <<span class="ocsforge_color_uid"|Req_found>> <<span class="ocsforge_color_keyword"|of>> <<span class="odocwiki_type"|<<span class="ocsforge_color_delimiter"| ( >><<a_api text="request" | type Ocsigen_extensions.request >> * <<a_api text="Ocsigen_http_frame.result" | type Ocsigen_http_frame.result >><<span class="ocsforge_color_delimiter"| ) >>>>>>>>>>>><<pre class="ocsforge_color odocwiki_code" id="TYPEextension2"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|extension~2>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_delimiter"| ( >>unit <<span class="ocsforge_color_delimiter"| -> >> unit<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="Ocsigen_cookies.cookieset" | type Ocsigen_cookies.cookieset >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="request_state" | type Ocsigen_extensions.request_state >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_delimiter"| ( >><<a_api text="answer" | type Ocsigen_extensions.answer >> * <<a_api text="Ocsigen_cookies.cookieset" | type Ocsigen_cookies.cookieset >><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>> >><<pre class="ocsforge_color odocwiki_code" id="TYPEextension"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|extension>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_type"|<<a_api text="request_state" | type Ocsigen_extensions.request_state >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="answer" | type Ocsigen_extensions.answer >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>> >><<div class="odocwiki_info"|~For each ~<site~> tag in the configuration file~,
    you can set the extensions you want~.
    ~Each extension is implemented as a function~, taking
    the charset found in configuration file~,
    the current state of the request~,
    and returning an answer~.
    ~If no page has been generated so far ~(<<span class="odocwiki_inlinecode"|~Req~_not~_found>>~)~, it receive
    the error code given by the previous extension ~(default ~4~0~4~)~,
    and the request information~.
    ~If a page has been generated by previous extensions ~(case <<span class="odocwiki_inlinecode"|~Req~_found>>~)~,
    the extension may want to modify the result ~(filters~)~.
>>
<<pre class="ocsforge_color odocwiki_code" id="TYPEparse_fun"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|parse~_fun>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_type"|<<span class="ocsforge_color_uid"|Simplexmlparser>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|xml>> list <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="extension2" | type Ocsigen_extensions.extension2 >>>> >><<pre class="ocsforge_color odocwiki_code" id="TYPEparse_host"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|parse~_host>>>><<div class="odocwiki_info"|~Type of the functions parsing the content of a ~<host~> tag
>>
<<pre class="ocsforge_color odocwiki_code" id="TYPEuserconf_info"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|userconf~_info>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="ocsforge_color_delimiter"|~{>>
<<span class="odocwiki_record"|<<span class="odocwiki_field"|<<span class="odocwiki_field_descr"|  <<span class="ocsforge_color_label"|localfiles_root:>> <<span class="odocwiki_type"|string>><<span class="ocsforge_color_delimiter"|~;>> >>>>>><<span class="ocsforge_color_delimiter"|~}>>>><<div class="odocwiki_info"|~Information received by extensions accepting userconf files~.


   ~The parameter <<span class="odocwiki_inlinecode"|localfiles~_root>> is an absolute path to the
   directory that the user is allowed to serve~. ~This is used
   by staticmod~, to disallow the user from allowing access to
   outside of this directory
>>
<<pre class="ocsforge_color odocwiki_code" id="TYPEparse_config"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|parse~_config>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_type"|\\  <<a_api text="virtual_hosts" | type Ocsigen_extensions.virtual_hosts >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="config_info" | type Ocsigen_extensions.config_info >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="parse_config_aux" | type Ocsigen_extensions.parse_config_aux >>>> >><<div class="odocwiki_info"|<<span class="odocwiki_inlinecode"|parse~_config>> is the type of the functions parsing a ~<site~> tag
    ~(and returning an extension~)~.  ~Those are functions taking
   
* the name of the virtual ~<host~>

     that will be called for each ~<host~>~,
     and that will generate a function taking~:
   
* the path attribute of a ~<site~> tag

     that will be called for each ~<site~>~,
     and that will generate a function taking~:
   
* an item of the config file

     that will be called on each tag inside ~<site~> and~:
   
* raise <<span class="odocwiki_inlinecode"|~Bad~_config~_tag~_for~_extension>> if it does not recognize that tag
* return something of type <<span class="odocwiki_inlinecode"|extension>> ~(filter or page generator~)



    <<span class="odocwiki_inlinecode"|parse~_config~_user>> is the type of functions parsing a site tag
    inside an userconf file~. ~They take one more parameter~, of type userconf~_info
>>
<<pre class="ocsforge_color odocwiki_code" id="TYPEparse_config_user"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|parse~_config~_user>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_type"|<<a_api text="userconf_info" | type Ocsigen_extensions.userconf_info >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="parse_config" | type Ocsigen_extensions.parse_config >>>> >><<pre class="ocsforge_color odocwiki_code" id="TYPEparse_config_aux"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|parse~_config~_aux>> <<span class="ocsforge_color_delimiter"|~=>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_uid"|Ocsigen_lib>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Url>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|path>> <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="parse_host" | type Ocsigen_extensions.parse_host >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="parse_fun" | type Ocsigen_extensions.parse_fun >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_uid"|Simplexmlparser>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|xml>> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="extension" | type Ocsigen_extensions.extension >>>> >><<pre id="VALregister_extension" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|register~_extension>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| name: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?fun_site: >><<a_api text="parse_config" | type Ocsigen_extensions.parse_config >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?user_fun_site: >><<a_api text="parse_config_user" | type Ocsigen_extensions.parse_config_user >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?begin_init: >><<span class="ocsforge_color_delimiter"| ( >>unit <<span class="ocsforge_color_delimiter"| -> >> unit<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?end_init: >><<span class="ocsforge_color_delimiter"| ( >>unit <<span class="ocsforge_color_delimiter"| -> >> unit<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?init_fun: >><<span class="ocsforge_color_delimiter"| ( >><<span class="ocsforge_color_uid"|Simplexmlparser>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|xml>> list <<span class="ocsforge_color_delimiter"| -> >> unit<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?exn_handler: >><<span class="ocsforge_color_delimiter"| ( >>exn <<span class="ocsforge_color_delimiter"| -> >> string<<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| ?respect_pipeline: >>bool <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_delimiter"| -> >> unit>>>><<div class="odocwiki_info"|~For each extension generating pages~, we register its name and six functions~:
* a function <<span class="odocwiki_inlinecode"|fun~_site>> of type <<span class="odocwiki_inlinecode"|parse~_config>>~. ~This function
will be responsible for handling the options of the configuration
files that are recognized by the extension~, and potentially generating
a page~.
* a function <<span class="odocwiki_inlinecode"|user~_fun~_site>> of type <<span class="odocwiki_inlinecode"|parse~_user~_config>> which has the
same role as <<span class="odocwiki_inlinecode"|fun~_site>>~, but inside userconf files~. ~Specify nothing
if your extension is disallowed in userconf files~. ~Otherwise~, compared
to <<span class="odocwiki_inlinecode"|fun~_site>>~, you can selectively disallow some options~,
as <<span class="odocwiki_inlinecode"|user~_fun~_site>> must define only safe options ~(for example it is not
safe to allow such options to load a cmo specified by a user~, or to
execute a program~, as this program will be executed by ocsigen~'s user~)~.
~Note that <<span class="odocwiki_inlinecode"|user~_fun~_site>> will be called for every request~, whereas the
<<span class="odocwiki_inlinecode"|fun~_site>> is called only when starting or reloading the server~.
* a function <<span class="odocwiki_inlinecode"|begin~_init>> that will be called at the beginning
of the initialisation phase of each site~, and each time the config file is
reloaded~.
* a function <<span class="odocwiki_inlinecode"|end~_init>> that will be called at the end of the initialisation
phase of each site
* a function <<span class="odocwiki_inlinecode"|init~_fun>> that will be called just before registering the
extension~, taking as parameter the configuration options between
<<span class="odocwiki_inlinecode"|~<extension~>>> and <<span class="odocwiki_inlinecode"|~<~/extension~>>>~. ~This allows to give configuration options
to extensions~. ~If no function is supplied~, the extension is supposed to
accept no option ~(and loading will fail if an option is supplied~)
~See ~<~<a~_api module~="~Ocsigen~_extensions~.~Configuration" ~| val process~_elements ~>~> for
the easy construction of such a function~.
* a function <<span class="odocwiki_inlinecode"|exn~_handler>> that will create an error message from the
exceptions that may be raised during the initialisation phase~, and raise again
all other exceptions

~Moreover~, if the optional parameter <<span class="odocwiki_inlinecode"|~?respect~_pipeline>> is <<span class="odocwiki_inlinecode"|true>>~,
the extension will ask the server to respect the order of the
pipeline~. ~That means that it will wait to be sure that the previous
request from the same connection has been taken by an extension
before giving a request to an extension~.  ~Use this to write proxies
extensions~, when you want to be able to pipeline the requests you
to another server~. ~It is false by default~.
>>
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|module>> <<a_api text="Configuration" | module Ocsigen_extensions.Configuration >> <<span class="ocsforge_color_delimiter"|~:>> <<span class="ocsforge_color_keyword"|sig>><<a_api text=".." | module Ocsigen_extensions.Configuration >><<span class="ocsforge_color_keyword"|end>>>><<div class="odocwiki_info"|~This modules contains types and constructor for the description of ~X~M~L
    configurations and the accordingly parsing~.
>>
<<pre id="VALget_hostname" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_hostname>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="request" | type Ocsigen_extensions.request >> <<span class="ocsforge_color_delimiter"| -> >> string>>>><<div class="odocwiki_info"|~Returns the hostname to be used for absolute links or redirections~.
    ~It is either the ~Host header or the hostname set in
    the configuration file~.
>>
<<pre id="VALget_port" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_port>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<a_api text="request" | type Ocsigen_extensions.request >> <<span class="ocsforge_color_delimiter"| -> >> int>>>><<div class="odocwiki_info"|~Returns the port to be used for absolute links or redirections~.
    ~It is either the port the server is listening at or the default port set in
    the configuration file~.
>>
<<pre id="VALri_of_url" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|ri~_of~_url>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?full_rewrite: >>bool <<span class="ocsforge_color_delimiter"| -> >>\\  string <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="request_info" | type Ocsigen_extensions.request_info >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="request_info" | type Ocsigen_extensions.request_info >>>>>><<div class="odocwiki_info"|~Parsing ~U~R~Ls~.
   ~This allows to modify the ~U~R~L in the request~_info~.
   ~(to be used for example with ~Ext~_retry~_with or ~Ext~_continue~_with~)
>>


===@@id="3_Userdirectories"@@~User directories===


~Exception raised when an non~-existing user is found
<<pre id="EXCEPTIONNoSuchUser" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|NoSuchUser>>>><<pre class="ocsforge_color odocwiki_code" id="TYPEud_string"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|ud~_string>>>><<div class="odocwiki_info"|~The type for string that may contain a ~$u~(~.~.~.~)
>>
<<pre id="VALparse_user_dir" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|parse~_user~_dir>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|string <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="ud_string" | type Ocsigen_extensions.ud_string >>>>>><<pre id="VALreplace_user_dir" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|replace~_user~_dir>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_uid"|Netstring_pcre>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|regexp>> <<span class="ocsforge_color_delimiter"| -> >>\\  <<a_api text="ud_string" | type Ocsigen_extensions.ud_string >> <<span class="ocsforge_color_delimiter"| -> >> string <<span class="ocsforge_color_delimiter"| -> >> string>>>><<div class="odocwiki_info"|raises <<span class="odocwiki_inlinecode"|~Not~_found>> is the directory does not exist
>>
<<pre id="EXCEPTIONNot_concerned" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Not_concerned>>>><<div class="odocwiki_info"|
===@@id="3_Regularexpressionsforredirections"@@~Regular expressions for redirections===

>>
<<pre id="VALfind_redirection" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|find~_redirection>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_uid"|Netstring_pcre>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|regexp>> <<span class="ocsforge_color_delimiter"| -> >>\\  bool <<span class="ocsforge_color_delimiter"| -> >>\\  string <<span class="ocsforge_color_delimiter"| -> >>\\  bool <<span class="ocsforge_color_delimiter"| -> >>\\  string option <<span class="ocsforge_color_delimiter"| -> >> int <<span class="ocsforge_color_delimiter"| -> >> string option <<span class="ocsforge_color_delimiter"| -> >> string <<span class="ocsforge_color_delimiter"| -> >> string <<span class="ocsforge_color_delimiter"| -> >> string>>>><<pre id="EXCEPTIONUnknown_command" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|exception>> <<span class="odocwiki_name"|Unknown_command>>>><<div class="odocwiki_info"|
===@@id="3_Extendingservercommands"@@~Extending server commands===

>>
<<pre id="VALregister_command_function" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|register~_command~_function>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?prefix: >>string <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_delimiter"| ( >>string <<span class="ocsforge_color_delimiter"| -> >> string list <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>><<span class="ocsforge_color_delimiter"| ) >> <<span class="ocsforge_color_delimiter"| -> >> unit>>>><<div class="odocwiki_info"|~Use a prefix for all your commands when you want to create
    extension~-specific commands~.
    ~For example if the prefix is "myextension" and the commande "blah"~,
    the actual command to be written by the user is "myextension~:blah"~.
    ~Give as parameter the function that will parse the command and do an action~.
    ~Its first parameter is the full command as a string~.
    ~The second one is the command without prefix~, split by word~.
    ~It must raise <<span class="odocwiki_inlinecode"|ocsigen~_extensions~.~Unknown~_command>> if it does
    not recognize the command~.
>>
