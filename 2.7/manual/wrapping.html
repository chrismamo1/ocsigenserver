<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title> Wrapping </title><meta charset="utf8"/><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="stylesheet" href="/css/style.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/themes/prism.min.css"/><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-core.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-ocaml.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-clike.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-reason.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-javascript.min.js"></script><script src="/js/client.js"></script></head><body class="ocsigenserver 2.7 wrapping"><div class="project-page"><div class="page-header"><p class="logo-ocsigen"><a href="/" class="ocsimore_phrasing_link"><img src="/img/ocsigen-white.svg" alt="Ocsigen"/></a>
</p><p class="logo-subproject">Server
</p><ul class="mainmenu"><li class="mainmenu-home"><a href="/" class="ocsimore_phrasing_link">Home</a>
</li><li class="mainmenu-doc"><a href="/tuto/6.2/manual/intro" class="ocsimore_phrasing_link">Doc</a>
</li><li><a href="/eliom/6.3/manual/intro" class="ocsimore_phrasing_link">Eliom</a>
</li><li><a href="/js_of_ocaml/3.1.0/manual/overview" class="ocsimore_phrasing_link">Js_of_ocaml</a>
</li><li><a href="/lwt/4.1.0/manual/manual" class="ocsimore_phrasing_link">Lwt</a>
</li><li><a href="/tyxml/4.3.0/manual/intro" class="ocsimore_phrasing_link">Tyxml</a>
</li><li><a href="/ocsigen-start/1.1.0/manual/intro" class="ocsimore_phrasing_link">Start</a>
</li></ul><aside class="how-drawer"><input id="how-drawer-toggle" type="checkbox"/><label for="how-drawer-toggle" id="how-drawer-label"><span class="how-drawer-icon"></span></label><nav class="how-drawer-content"><ul class="drawermainmenu"><li class="drawermainmenu-home"><a href="/" class="ocsimore_phrasing_link">Home</a>
</li><li class="drawermainmenu-doc"><a href="/tuto/6.2/manual/intro" class="ocsimore_phrasing_link">Doc</a>
</li><li class="drawermainmenu-project"><a href="/eliom/6.3/manual/intro" class="ocsimore_phrasing_link">Eliom</a>
</li><li class="drawermainmenu-project"><a href="/js_of_ocaml/3.1.0/manual/overview" class="ocsimore_phrasing_link">Js_of_ocaml</a>
</li><li class="drawermainmenu-current drawermainmenu-project"><a href="/ocsigenserver/2.9/manual/quickstart" class="ocsimore_phrasing_link">Server</a>
</li><li class="drawermainmenu-project"><a href="/lwt/4.1.0/manual/manual" class="ocsimore_phrasing_link">Lwt</a>
</li><li class="drawermainmenu-project"><a href="/tyxml/4.3.0/manual/intro" class="ocsimore_phrasing_link">Tyxml</a>
</li><li class="drawermainmenu-project"><a href="/ocsigen-toolkit/1.1.0/manual/intro" class="ocsimore_phrasing_link">Toolkit</a>
</li><li class="drawermainmenu-project"><a href="/ocsigen-start/1.1.0/manual/intro" class="ocsimore_phrasing_link">Start</a>
</li><li class="drawermainmenu-page"><a href="/projects" class="ocsimore_phrasing_link">Other projects</a>
</li><li class="drawermainmenu-page"><a href="/papers" class="ocsimore_phrasing_link">Research papers</a>
</li><li class="drawermainmenu-page"><a href="/credits" class="ocsimore_phrasing_link">Who does Ocsigen?</a>
</li><li class="drawermainmenu-page"><a href="/blog" class="ocsimore_phrasing_link">Blog</a>
</li><li class="drawermainmenu-page"><a href="https://github.com/ocsigen" class="ocsimore_phrasing_link">Source code</a>
</li></ul><nav class="how-doctree"><h1>Ocsigen server</h1><h2>Usage</h2><h3><a href="/ocsigenserver/2.7/manual/quickstart" class="ocsimore_phrasing_link">Quick start</a></h3><h3><a href="/ocsigenserver/2.7/manual/launching" class="ocsimore_phrasing_link">Launching the server</a></h3><h3><a href="/ocsigenserver/2.7/manual/config" class="ocsimore_phrasing_link">Configuration file</a></h3><h3><a href="/ocsigenserver/2.7/manual/misc" class="ocsimore_phrasing_link">Misc</a></h3><h2>Extensions</h2><h3><a href="/ocsigenserver/2.7/manual/staticmod" class="ocsimore_phrasing_link">Staticmod</a></h3><h3><a href="/ocsigenserver/2.7/manual/eliom" class="ocsimore_phrasing_link">Eliom</a></h3><h3><a href="/ocsigenserver/2.7/manual/extendconfiguration" class="ocsimore_phrasing_link">Extendconfiguration</a></h3><h3><a href="/ocsigenserver/2.7/manual/accesscontrol" class="ocsimore_phrasing_link">Accesscontrol</a></h3><h3><a href="/ocsigenserver/2.7/manual/authbasic" class="ocsimore_phrasing_link">Authbasic</a></h3><h3><a href="/ocsigenserver/2.7/manual/cgimod" class="ocsimore_phrasing_link">CGImod</a></h3><h3><a href="/ocsigenserver/2.7/manual/deflatemod" class="ocsimore_phrasing_link">Deflatemod</a></h3><h3><a href="/ocsigenserver/2.7/manual/redirectmod" class="ocsimore_phrasing_link">Redirectmod</a></h3><h3><a href="/ocsigenserver/2.7/manual/revproxy" class="ocsimore_phrasing_link">Revproxy</a></h3><h3><a href="/ocsigenserver/2.7/manual/rewritemod" class="ocsimore_phrasing_link">Rewritemod</a></h3><h3><a href="/ocsigenserver/2.7/manual/outputfilter" class="ocsimore_phrasing_link">Outputfilter</a></h3><h3><a href="/ocsigenserver/2.7/manual/userconf" class="ocsimore_phrasing_link">Userconf</a></h3><h3><a href="/ocsigenserver/2.7/manual/comet" class="ocsimore_phrasing_link">Comet</a></h3><h3><a href="/ocsigenserver/2.7/manual/cors" class="ocsimore_phrasing_link">CORS</a></h3><h2>Developer documentation</h2><h3>Developing with the Ocsigen framework</h3><h4><a href="/ocsigenserver/2.7/manual/lwtoc" class="ocsimore_phrasing_link">Cooperative threads</a></h4><h4><a href="/ocsigenserver/2.7/manual/staticlink" class="ocsimore_phrasing_link">Static linking of the Ocsigen server</a></h4><h3><a href="/ocsigenserver/2.7/manual/extend" class="ocsimore_phrasing_link">Writing an extension</a></h3><h3><a href="/ocsigenserver/2.7/manual/libraries" class="ocsimore_phrasing_link">Libraries</a></h3><h3><a href="/ocsigenserver/2.7/manual/wrapping" class="ocsimore_phrasing_link">specific wrapping</a></h3><h1>Ocsigen server - API reference</h1><h2>Persistent data, writing in the logs, configuration file extension, polymorphic tables</h2><h3><a href="/ocsigenserver/2.7/api/Ocsigen_lib" class="ocsimore_phrasing_link">Ocsigen_lib</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_messages" class="ocsimore_phrasing_link">Ocsigen_messages</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_parseconfig" class="ocsimore_phrasing_link">Ocsigen_parseconfig</a></h3><h3><a href="/ocsigenserver/2.7/api/Polytables" class="ocsimore_phrasing_link">Polytables</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_cache" class="ocsimore_phrasing_link">Ocsigen_cache</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsipersist" class="ocsimore_phrasing_link">Ocsipersist</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_config" class="ocsimore_phrasing_link">Ocsigen_config</a></h3><h2>Extending Ocsigen Server</h2><h3><a href="/ocsigenserver/2.7/api/Ocsigen_extensions" class="ocsimore_phrasing_link">Ocsigen_extensions</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_local_files" class="ocsimore_phrasing_link">Ocsigen_local_files</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_headers" class="ocsimore_phrasing_link">Ocsigen_headers</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_senders" class="ocsimore_phrasing_link">Ocsigen_senders</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_http_frame" class="ocsimore_phrasing_link">Ocsigen_http_frame</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_http_client" class="ocsimore_phrasing_link">Ocsigen_http_client</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_http_com" class="ocsimore_phrasing_link">Ocsigen_http_com</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_stream" class="ocsimore_phrasing_link">Ocsigen_stream</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_comet" class="ocsimore_phrasing_link">Ocsigen_comet</a></h3><h3><a href="/ocsigenserver/2.7/api/Authbasic" class="ocsimore_phrasing_link">Authbasic</a></h3><h2>Indexes</h2><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/index_types">Index of types</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/index_exceptions">Index of exceptions</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/index_values">Index of values</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/index_methods">Index of class methods</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/index_classes">Index of classes</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/index_modules">Index of modules</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/index_module_types">Index of module types</a></span></h3></nav></nav></aside></div><p class="reasonwarning">Warning: Reason support is experimental.
We are looking for beta-tester and contributors.
</p><button id="reason">Switch to </button><div class="twocols"><nav class="leftcol">Version <select class="how-versions" onchange="location = this.value;"><option value="/ocsigenserver/dev/manual/wrapping">dev</option><option value="/ocsigenserver/2.9/manual/wrapping">2.9</option><option value="/ocsigenserver/2.8/manual/wrapping">2.8</option><option selected="selected">2.7</option><option value="/ocsigenserver/2.6/manual/wrapping">2.6</option><option value="/ocsigenserver/2.5/manual/wrapping">2.5</option><option value="/ocsigenserver/2.3/manual/wrapping">2.3</option><option value="/ocsigenserver/2.2/manual/wrapping">2.2</option><option value="/ocsigenserver/2.1/manual/wrapping">2.1</option><option value="/ocsigenserver/1.3.4/manual/wrapping">1.3.4</option><option value="/ocsigenserver/1.2.2/manual/wrapping">1.2.2</option><option value="/ocsigenserver/1.1.0/manual/wrapping">1.1.0</option></select><form id="search"><input name="q" id="q" placeholder="search ..."/><button>Search</button></form><nav class="how-doctree"><h1>Ocsigen server</h1><h2>Usage</h2><h3><a href="/ocsigenserver/2.7/manual/quickstart" class="ocsimore_phrasing_link">Quick start</a></h3><h3><a href="/ocsigenserver/2.7/manual/launching" class="ocsimore_phrasing_link">Launching the server</a></h3><h3><a href="/ocsigenserver/2.7/manual/config" class="ocsimore_phrasing_link">Configuration file</a></h3><h3><a href="/ocsigenserver/2.7/manual/misc" class="ocsimore_phrasing_link">Misc</a></h3><h2>Extensions</h2><h3><a href="/ocsigenserver/2.7/manual/staticmod" class="ocsimore_phrasing_link">Staticmod</a></h3><h3><a href="/ocsigenserver/2.7/manual/eliom" class="ocsimore_phrasing_link">Eliom</a></h3><h3><a href="/ocsigenserver/2.7/manual/extendconfiguration" class="ocsimore_phrasing_link">Extendconfiguration</a></h3><h3><a href="/ocsigenserver/2.7/manual/accesscontrol" class="ocsimore_phrasing_link">Accesscontrol</a></h3><h3><a href="/ocsigenserver/2.7/manual/authbasic" class="ocsimore_phrasing_link">Authbasic</a></h3><h3><a href="/ocsigenserver/2.7/manual/cgimod" class="ocsimore_phrasing_link">CGImod</a></h3><h3><a href="/ocsigenserver/2.7/manual/deflatemod" class="ocsimore_phrasing_link">Deflatemod</a></h3><h3><a href="/ocsigenserver/2.7/manual/redirectmod" class="ocsimore_phrasing_link">Redirectmod</a></h3><h3><a href="/ocsigenserver/2.7/manual/revproxy" class="ocsimore_phrasing_link">Revproxy</a></h3><h3><a href="/ocsigenserver/2.7/manual/rewritemod" class="ocsimore_phrasing_link">Rewritemod</a></h3><h3><a href="/ocsigenserver/2.7/manual/outputfilter" class="ocsimore_phrasing_link">Outputfilter</a></h3><h3><a href="/ocsigenserver/2.7/manual/userconf" class="ocsimore_phrasing_link">Userconf</a></h3><h3><a href="/ocsigenserver/2.7/manual/comet" class="ocsimore_phrasing_link">Comet</a></h3><h3><a href="/ocsigenserver/2.7/manual/cors" class="ocsimore_phrasing_link">CORS</a></h3><h2>Developer documentation</h2><h3>Developing with the Ocsigen framework</h3><h4><a href="/ocsigenserver/2.7/manual/lwtoc" class="ocsimore_phrasing_link">Cooperative threads</a></h4><h4><a href="/ocsigenserver/2.7/manual/staticlink" class="ocsimore_phrasing_link">Static linking of the Ocsigen server</a></h4><h3><a href="/ocsigenserver/2.7/manual/extend" class="ocsimore_phrasing_link">Writing an extension</a></h3><h3><a href="/ocsigenserver/2.7/manual/libraries" class="ocsimore_phrasing_link">Libraries</a></h3><h3><a href="/ocsigenserver/2.7/manual/wrapping" class="ocsimore_phrasing_link">specific wrapping</a></h3><h1>Ocsigen server - API reference</h1><h2>Persistent data, writing in the logs, configuration file extension, polymorphic tables</h2><h3><a href="/ocsigenserver/2.7/api/Ocsigen_lib" class="ocsimore_phrasing_link">Ocsigen_lib</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_messages" class="ocsimore_phrasing_link">Ocsigen_messages</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_parseconfig" class="ocsimore_phrasing_link">Ocsigen_parseconfig</a></h3><h3><a href="/ocsigenserver/2.7/api/Polytables" class="ocsimore_phrasing_link">Polytables</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_cache" class="ocsimore_phrasing_link">Ocsigen_cache</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsipersist" class="ocsimore_phrasing_link">Ocsipersist</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_config" class="ocsimore_phrasing_link">Ocsigen_config</a></h3><h2>Extending Ocsigen Server</h2><h3><a href="/ocsigenserver/2.7/api/Ocsigen_extensions" class="ocsimore_phrasing_link">Ocsigen_extensions</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_local_files" class="ocsimore_phrasing_link">Ocsigen_local_files</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_headers" class="ocsimore_phrasing_link">Ocsigen_headers</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_senders" class="ocsimore_phrasing_link">Ocsigen_senders</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_http_frame" class="ocsimore_phrasing_link">Ocsigen_http_frame</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_http_client" class="ocsimore_phrasing_link">Ocsigen_http_client</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_http_com" class="ocsimore_phrasing_link">Ocsigen_http_com</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_stream" class="ocsimore_phrasing_link">Ocsigen_stream</a></h3><h3><a href="/ocsigenserver/2.7/api/Ocsigen_comet" class="ocsimore_phrasing_link">Ocsigen_comet</a></h3><h3><a href="/ocsigenserver/2.7/api/Authbasic" class="ocsimore_phrasing_link">Authbasic</a></h3><h2>Indexes</h2><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/index_types">Index of types</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/index_exceptions">Index of exceptions</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/index_values">Index of values</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/index_methods">Index of class methods</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/index_classes">Index of classes</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/index_modules">Index of modules</a></span></h3><h3> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/index_module_types">Index of module types</a></span></h3></nav></nav><article class="rightcol"><h1> Wrapping </h1><h2> Basics </h2><p>The server side of Eliom can communicates to the client other kind of
data than the raw XML contents of the pages. The wrapper mecanism is
used to allow the browser side to access to the contents of variables
declared on server side. For instance when we write
</p><pre class=""><code class="language-ocaml translatable">Eliom_services.onload {{ Dom_html.window##alert(Js.string %text) }}</code></pre><p>the contents of the <span class="teletype">text</span> variable is sent along the page for the client code to access it.
</p><p>Server side, when </p><pre class=""><code class="language-ocaml translatable">{{ Dom_html.window##alert(Js.string %text) }}</code></pre><p>is executed, the variable <span class="teletype">text</span> is registered into a table and an id is associated to it.
This table will containt all the datas references by variables annotated with % in a page, and
will be sent marshalled to the client. On client side the id will be used to retrieve <span class="teletype">text</span>.
</p><p>Since all datas are sent in one table, if a variable is referenced
multiples times, it will be sent only once, and sharing will be preserved: 
</p><pre class=""><code class="language-ocaml translatable">let a = ref 0 in
let b = (1,a) in

Eliom_services.onload
 {{
    %a := 42;
    Dom_html.window##alert(Js.string (string_of_int (snd (%b))))
 }}</code></pre><p>This code will display 42. After being sent, the client and server
side values are distinct: the server side version of <span class="teletype">a</span> won't be
modified by the client side affectation and conversly the client side
value won't change if <span class="teletype">a</span> is changed later on server side.
</p><h2> Special types </h2><h3> Specific wrappers </h3><p>Usualy, client and server side values are represented the same way,
and it is sufficient to only copy their content ( marshalled ) to the
client. But certain types can't be transmitted this easilly: for
instance, services.
</p><p>Those values must be transformed before marshalling: We need for this to use
specific wrappers. This wrapping mechanism is defined in
<span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/Eliom_wrap">Eliom_wrap</a></span>.
</p><p>Before sending, the values goes throught <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/Eliom_wrap#VALwrap">Eliom_wrap.​wrap</a></span>
wich transform marked values. A value marked is a value which have as its last field
a value of type <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/Eliom_wrap#TYPEwrapper">Eliom_wrap.​wrapper</a></span>. For instance
</p><pre class=""><code class="language-ocaml translatable">type marked_tupple = ( int * ... * marked_tupple Eliom_wrap.wrapper )
type marked_record =
     { f1 : int;
          ...
       fn : marked_record Eliom_wrap.wrapper }</code></pre><p>but not
</p><pre class=""><code class="language-ocaml translatable">type not_marked_tupple = ( int * ... * marked_tupple Eliom_wrap.wrapper * float )
type not_marked_tupple = ( int * ... * ( int * marked_tupple Eliom_wrap.wrapper ) )
type not_marked_tupple = ( int * ... * marked_tupple Eliom_wrap.wrapper list )
type not_marked_record =
     { f1 : int;
          ...
       fn : marked_record Eliom_wrap.wrapper;
       fk : float; }</code></pre><p>A wrapper is created by the <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/Eliom_wrap#VALcreate_wrapper">Eliom_wrap.​create_wrapper</a></span>
function. It takes a function as parameter wich will be called to
transform the value during the wrapping. There is also a special wrapper
<span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/Eliom_wrap#VALempty_wrapper">Eliom_wrap.​empty_wrapper</a></span> wich does nothing. It is usefull
to stop calling the wrapper on a value: If there is still a wrapper in a
value after its transformation, it will be called another time, potentially
leading to an infinite loop.
</p><p>For instance 
</p><pre class=""><code class="language-ocaml translatable">type v = Fun of unit -&gt; int | Value of int
type wrapped_type = ( v * wrapped_type)
let wrapper = Eliom_wrap.create_wrapper (function
     | Value i,wrapper -&gt; Value i, Eliom_wrap.empty_wrapper
     | Fun f,wrapper -&gt; Value (f ()), Eliom_wrap.empty_wrapper)
let v = ( Fun (fun () -&gt; 1), wrapper )
let _,(v', empty_wrapper) = Eliom_wrap.wrap v</code></pre><p>At that time <span class="teletype">v&quot;</span> will be <span class="teletype">Value 1</span>. Notice that
<span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/Eliom_wrap#VALcreate_wrapper">Eliom_wrap.​create_wrapper</a></span> does not enforce the output
type of the wrapping function to be the same as the input type:
Eliom_wrap is to be use with much caution! Do not use it if you don't
understand how it works, it may lead to unpredictable segmentation faults
and corrupted memory.
</p><h3> Specific unwrappers </h3><p>We may also want to modify the value at unwrapping time. It is the
case for instance of the type <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/Eliom_react.Up#TYPEt">Eliom_react.​Up.​t</a></span>. On server
side, it is transformed to a service, and the service is transformed to a
function wich call it on client side.
</p><p>To do this, we use specific unwrappers. A value is marked by an unwrapper
the same way as with wrappers: A value is marked if its last field is a
value of type <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/Eliom_wrap#TYPEunwrapper">Eliom_wrap.​unwrapper</a></span>. An unwrapper does
not contain functions, it only contains an identifier of type
<span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/Eliom_wrap#TYPEunwrap_id">Eliom_wrap.​unwrap_id</a></span>. On client side a function can
be registered to transformed values marked with an id:
<span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/Eliom_client_unwrap#VALregister_unwrapper">Eliom_client_unwrap.​register_unwrapper</a></span>.
</p><pre class=""><code class="language-ocaml translatable">type marked_int = (int * marked_int Eliom_wrap.unwrapper)

{shared{let marked_int_id = 123456}}

let v : marked_int = ( 10, Eliom_wrap.create_unwrapper (Eliom_wrap.id_of_int marked_int_id))

{client{
  let marked_int_unwrapper ( i, unwrapper ) = ( fun j -&gt; i + j )
  let id = Eliom_client_unwrap.id_of_int marked_int_id
  let () = Eliom_client_unwrap.register_unwrapper id marked_int_unwrapper
}}</code></pre><p>When the client will receive the value <span class="teletype">v</span> it will transform it to <span class="teletype">fun j -&gt; j + 10</span>
</p><p>Thoses id are globals, take care of not using an existing one, you
could for instance use the name of you type hashed as id. Consider
those below 1024 to be reserved to Eliom internals.
</p><h2> Eliom specific types </h2><p>The Eliom types that are marked are:
</p><ul><li> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/Eliom_services#TYPEservice">Eliom_services.​service</a></span> transformed to <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/Eliom_services#TYPEservice">Eliom_services.​service</a></span> (but the client side representation)
</li><li> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/Eliom_comet.Channels#TYPEt">Eliom_comet.​Channels.​t</a></span> transformed to <span><a class="ocsforge_doclink_lwt" href="/lwt/4.1.0/api/Lwt_stream#TYPEt">Lwt_stream.​t</a></span>
</li><li> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/Eliom_react.Up#TYPEt">Eliom_react.​Up.​t</a></span> transformed to <span class="teletype"> 'a -&gt; unit </span>
</li><li> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/Eliom_react.Down#TYPEt">Eliom_react.​Down.​t</a></span> transformed to <span class="teletype"> 'a React.E.t </span>
</li><li> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/Eliom_bus#TYPEt">Eliom_bus.​t</a></span> transformed to <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/Eliom_bus#TYPEt">Eliom_bus.​t</a></span>
</li><li> <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/XML#TYPEt">XML.​t</a></span> transformed to <span><a class="ocsforge_doclink_ocsigenserver" href="/ocsigenserver/2.7/api/XML#TYPEt">XML.​t</a></span> (but the client side representation)
</li></ul><h3> Additionnal notes for XML </h3><p>Client and server side behaviour differ:
</p><ul><li> On server side XML is a tree wich allow sharing. i.e. it can be an acyclic graph.
</li><li> On client side XML use the internal browser representation wich doesn't allow sharing
</li></ul><p>This can affect the behaviour for instance when doing:
</p><pre class=""><code class="language-ocaml translatable">let a = div []
let b = div [a;a]
let c = div [pcdata &quot;text&quot;]

...

  {{ Dom.appendChild %a %c }}</code></pre><p>when the value was sent, the node <span class="teletype">a</span> was copied 2 times and only
the second one is referenced by <span class="teletype">%a</span>: the node <span class="teletype">c</span> will be
added as a child to the second <span class="teletype">a</span> not to the first one.
</p></article></div></div></body></html>
